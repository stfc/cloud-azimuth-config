---
azimuth_capi_operator_fluent_operator_values:
  fluentbit:
    enable: true

    serviceMonitor:
      enable: false
      interval: 30s
      path: /api/v2/metrics/prometheus
      scrapeTimeout: 10s
      secure: false
    
    resources:
      limits:
        cpu: 500m
        memory: 400Mi
      requests:
        cpu: 10m
        memory: 25Mi
    
    annotations:
      fluentbit.io/exclude: "true"
      promtheus.io/scrape: "true"

    input:
      tail:
        enable: true
      systemd:
        enable: true

    output:
      opensearch: "{{ fluent_operator_user_opensearch_config }}"
      loki:
        enable: true
        host: loki-stack
        port: 3100
        tenantID: ""
        labels:
          - job=fluent-bit
          - pod=$kubernetes['pod_name']
          - namespace=$kubernetes['namespace_name']
          - container_name=$kubernetes['container_name']
          # - app=$kubernetes['labels']['app'] # This isn't standard (i.e. sometimes its labels.k8s.app); and it generally duplicates container_name anyway
        removeKeys: []
        autoKubernetesLabels: "off" # Only seems to work for labels and annotations, not metadata. Disabling and doing it myself!
        lineFormat: json

    filter:
      kubernetes:
        enable: true
        labels: true
        annotations: false
      containerd:
        enable: true
      systemd:
        enable: true

  fluentd:
    enable: false
